function reset_adv() {
  document.getElementById('EDR').value = '100';
  document.getElementById('overhead').value = '93';
}

function mouse_click(dl, dlu, ul, ulu) {

  document.getElementById('downlink').value = dl;
  document.getElementById('downunit').value = dlu;
  document.getElementById('uplink').value = ul;
  document.getElementById('upunit').value = ulu;

  cal();
}

function cap_denom(unit) {
  var denom;
  if (unit == 'b') {
    denom = 1;
  }
  if (unit == 'kb') {
    denom = 1024;
  }
  if (unit == 'mb') {
    denom = 1024000;
  }
  if (unit == 'gb') {
    denom = 1024000000;
  }
  if (unit == 'B') {
    denom = 8;
  }
  if (unit == 'K') {
    denom = 8192;
  }
  if (unit == 'M') {
    denom = 8388608;
  }
  if (unit == 'G') {
    denom = 8589934592;
  }
  return denom;
}

function unit_nearest(num) {

  var capunits = new Array("Byte", "KB", "MB", "GB", "TB", "PB", "EB");
  // var capunits = ["Byte", "KB", "MB", "GB", "TB", "PB", "EB"];
  var cap = 0;

  while (num >= 1024) {
    num = num / 1024;
    cap++;
  }


  return Math.round(num * 10) / 10 + ' ' + capunits[cap];
}

// 时间 / 1 年 312 日 53 分 20 秒
function time_split(num) {

  var timeunits = new Array(" 秒 ", " 分 ", " 小时 ", " 日 ", " 年 ");
  var timestr = '';
  //year
  if (num >= 31536000) {
    yr = Math.floor(num / 31536000);
    num = num % 31536000;
    timestr += yr + timeunits[4];
  }

  //day
  if (num >= 86400) {
    day = Math.floor(num / 86400);
    num = num % 86400;
    timestr += day + timeunits[3];
  }
  //hour
  if (num >= 3600) {
    hr = Math.floor(num / 3600);
    num = num % 3600;
    timestr += hr + timeunits[2];
  }
  //min
  if (num >= 60) {
    min = Math.floor(num / 60);
    num = num % 60;
    timestr += min + timeunits[1];
  }
  timestr += num + timeunits[0];

  return timestr;
}

function DateTime(DateT) {
  // var DateT = '';
  // DateT = '';
  var date = new Date();
  var year = date.getFullYear();
  var month = date.getMonth();
  var day = date.getDate();
  var h = date.getHours();
  var m = date.getMinutes();
  var s = date.getSeconds();

  // DateT = `${year}/${month + 1}/${day} ${h}:${m}:${s}`;
  DateT = `${year}年${month + 1}月${day}日  ${h}:${m}:${s}`;

  return DateT;
}
DateTime()

function cal() {
  var filesize = document.getElementById('filesize').value;
  var sizeunit = document.getElementById('unit').value;
  var dbw = document.getElementById('downlink').value;
  var ubw = document.getElementById('uplink').value;
  var du = document.getElementById('downunit').value;
  var uu = document.getElementById('upunit').value;
  var overhead = document.getElementById('overhead').value;
  var EDR = document.getElementById('EDR').value;

  var downunit = cap_denom(du);
  var upunit = cap_denom(uu);

  //break to bps, then Byte/S

  var downlink = dbw * downunit / 8;
  var uplink = ubw * upunit / 8;

  var filebytes = filesize * sizeunit;
  var dtime = Math.round(filebytes / downlink);
  var utime = Math.round(filebytes / uplink);
  var rdtime = Math.round(filebytes / downlink * (100 / overhead) * (100 / EDR));
  var rutime = Math.round(filebytes / uplink * (100 / overhead) * (100 / EDR));
  // document.getElementById('info').innerHTML = '下载频宽: ' + unit_nearest(downlink) + '/S';
  // document.getElementById('info').innerHTML += '<br>上传频宽: ' + unit_nearest(uplink) + '/S<br><br>';
  document.getElementById('info').innerHTML = `<span>下载带宽:  ${unit_nearest(downlink)}/s</span>`;
  document.getElementById('info').innerHTML += `<span>上传带宽: ${unit_nearest(uplink)}/s</span>`;
  document.getElementById('dtime').innerHTML = '下载所需时间(理论值): ' + time_split(dtime);
  document.getElementById('utime').innerHTML = '上传所需时间(理论值): ' + time_split(utime);
  document.getElementById('rdtime').innerHTML = '下载所需时间: ' + time_split(rdtime);
  document.getElementById('rutime').innerHTML = '上传所需时间: ' + time_split(rutime);




  // var ud = DateTime();
  // var dd = DateTime();

  // var ud, dd;
  // var ud = DateTime(ETA(dtime));
  // var dd = DateTime(ETA(dtime));

  // var ud = new Date();
  // var dd = new Date();
  // dd.setTime(ETA(dtime));
  // ud.setTime(ETA(utime));

  document.getElementById('deta').innerHTML = '下载预计完成时间: ' + DateTime(ETA(dtime));
  document.getElementById('ueta').innerHTML = '上传预计完成时间: ' + DateTime(ETA(dtime));

  /*
  dd.toDateString();          Wed Aug 18 2021
  dd.toLocaleString();        2021/8/18 下午12:06:20
  toLocaleTimeString();     上午11:58:40


  * */

}

function ETA(seconds) {

  /*var DateT = '';
  var date = new Date();
  var year = date.getFullYear();
  var month = date.getMonth();
  var day = date.getDate();
  var h = date.getHours();
  var m = date.getMinutes();

  DateT = `${year}/${month + 1}/${day} ${h}:${m}`;
  console.log(DateT);*/
  // DateT = year / month + 1 / day / h / m;

  // var d = new Date();
  // var t = DateT;

  var d = new Date();
  var t = d.getTime();

  var eta = (seconds * 1000) + t;

  return eta;
}
